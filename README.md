## Установка и запуск проекта на Django с использованием ngrok

### Шаг 1: Создать окружение и установите пакеты

Для установки и запуска проекта на Django требуется Python и пакетный менеджер pip. 
Рекомендуется создать виртуальное окружение, в котором будет установлен проект.
```sh
$ python3 -m venv myenv
$ source myenv/bin/activate
$ pip install -r requirements.txt
```

### Шаг 2: Установить миграции и создать базу db.sqlite3
```sh
(myenv)$ python manage.py migrate
```

### Шаг 3: Установить ngrok для системы Ubuntu

Для установки ngrok выполните следующие команды:

```sh
$ sudo snap install ngrok
$ ngrok config add-authtoken TOKEN
```
Для получения дополнительной информации и инструкций по использованию ngrok 
обратитесь к официальной документации на сайте [ngrok.com](https://dashboard.ngrok.com/get-started/setup).
TOKEN можно получить по ссылке https://dashboard.ngrok.com/get-started/your-authtoken

### Шаг 4: Запустить ngrok на порту 8080

Для запуска ngrok на порту 8080 выполните следующую команду:

```sh
$ ngrok http 8080
```

После запуска ngrok вы увидите временный URL-адрес, который можно использовать 
для доступа к вашему приложению из Интернета. Необходим для AUDD! 

### Шаг 5: Создайте файл с переменными окружения .env
Образец файла sample.env. 
Отредактируйте файл .env и добавьте следующие переменные окружения:
```sh
$ mv sample.env .env
$ nano .env
```
```
DISCOGS_TOKEN='TOKEN'
AUDD_TOKEN='TOKEN'
GENIUS_CLIENT_ACCESS_TOKEN='TOKEN'
```

###  Шаг 6: Добавивить домен Forwarding ngrok в файл .env

После запуска ngrok вы увидите строку "Forwarding", которая содержит доменное 
имя временного URL-адреса. Добавьте его в файл .env, чтобы обеспечить 
корректную работу приложения:

```sh
NGROK_DOMAIN='me.eu.ngrok.io'
```

### Шаг 7: Запустить проект на порту 8000

Выполните следующую команду, чтобы запустить проект на порту 8000:

```sh
$ python manage.py runserver 127.0.0.1:8000
```

### Шаг 8: Запустить проект на порту 8080

Для запуска проекта на порту 8080 выполните следующую команду:

```sh
$ python manage.py runserver 127.0.0.1:8080
```





## К чему такие сложности?

Бесплатный ключ AUDD_TOKEN имеет ряд ограничей. Например, я так и не смог 
проверить отправку файла им напрямую. Выдает ошибку. Но, можно отправить ссылку
на сам файл. Тут свои ограничения, файл на 30 секунд и не больше 10 МБ.
Но метод рабочий.

> Второе приложение нужно, что AUDD обратился за файлом к нам. Решение красивое, 
> но только для разработки. 

Для проверки откройте страницу http://127.0.0.1:8000/search/ 
Выберите файл и нажмите кнопку отправки. 
В консоле первого приложения можно увидеть, куда и с каким успехом мы обратились.
Сначала пробуем получить информацию через AUDD.
Если успешно, то подключаем остальные сервисы на основание ответов от AUDD 
(артист и трек) Если AUDD выдал ошибку (см консоль), то пробуем получить артист 
и трек из названия файла.
В названии файла предпалагаем, что первым идет артист.
Разделитель пробел тире пробел " - ".
Затем название трека.
Нумерация трека тоже возможна, например, 
```
01. Alexei Zakharov - Cradle of Humanity.mp3
ИмяТрека.mp3
```

## ЭТО НЕ ПРОДАКШЕН РЕШЕНИЕ!
Для запуска в продакшен необходимо запросы к сторонним сервисам делать асинхронно.
* Например, через постановку задачи для Celery.
* Использовать другую базу, например, Postgres.
* Запуск на отдельном сервере с белым IP и своим доменным именем.

